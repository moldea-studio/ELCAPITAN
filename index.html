<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>El Capit√°n - F√∫tbol Amateur</title>
    
    <!-- PWA Settings -->
    <meta name="theme-color" content="#00ff55">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="El Capit√°n">
    <link rel="apple-touch-icon" id="apple-icon">
    <link rel="icon" type="image/png" id="favicon">
    <link rel="manifest" id="manifest-placeholder">

    <!-- CONFIGURACI√ìN DE √çCONOS REALES -->
    <script>
        (function() {
            const iconUrl = "https://i.imgur.com/evLI09R.png";
            document.getElementById('apple-icon').href = iconUrl;
            document.getElementById('favicon').href = iconUrl;
            const manifest = {
                "name": "El Capit√°n",
                "short_name": "El Capit√°n",
                "start_url": ".",
                "display": "standalone",
                "background_color": "#111827",
                "theme_color": "#00ff55",
                "orientation": "portrait",
                "icons": [
                    { "src": iconUrl, "sizes": "192x192", "type": "image/png" },
                    { "src": iconUrl, "sizes": "512x512", "type": "image/png" }
                ]
            };
            const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
            document.getElementById('manifest-placeholder').setAttribute('href', URL.createObjectURL(blob));
        })();
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Estilos base -->
    <style>
        body { background-color: #111827; color: #e5e7eb; font-family: sans-serif; padding-bottom: 100px; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #00ff55; border-radius: 4px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #root { min-height: 100vh; display: flex; flex-direction: column; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root">
        <div class="flex-1 flex items-center justify-center text-[#00ff55] animate-pulse">
            <svg class="w-10 h-10 animate-spin mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
            </svg>
            Cargando El Capit√°n...
        </div>
    </div>

    <script type="text/babel" data-type="module" data-presets="react">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            Users, MapPin, Calendar, Shield, Search, PlusCircle, AlertCircle, 
            ChevronRight, Swords, Star, Menu, X, Filter, User, LogOut, Bell, 
            Trophy, Trash2, Download, Home, Share2, Crown, UserX, UserCheck, MinusCircle
        } from 'https://esm.sh/lucide-react@0.294.0';
        
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        // NOTA: Desactivamos AppCheck temporalmente para evitar errores de reCAPTCHA en desarrollo
        // import { initializeAppCheck, ReCaptchaV3Provider } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app-check.js';
        import { 
            getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, signInAnonymously 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { 
           getFirestore, collection, query, onSnapshot, doc, updateDoc, increment, 
           arrayUnion, arrayRemove, addDoc, serverTimestamp, deleteDoc, where, 
           getDoc, setDoc, getDocs, Timestamp 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // --- CONSTANTES ---
        const appId = 'el-capitan-web';
        const ADMIN_EMAILS = ["worlddigital2011@gmail.com", "admin@elenganche.com", "eyamilgimenez98@gmail.com"];
        const ZONES_BY_AREA = {
            "Casco Urbano": ["La Plata (Casco Urbano)"],
            "Zona Norte": ["Arturo Segu√≠", "Villa Elisa", "City Bell", "Manuel B. Gonnet", "Ringuelet", "Tolosa"],
            "Zona Oeste": ["San Carlos", "Los Hornos", "Lisandro Olmos", "Melchor Romero", "Abasto"],
            "Zona Sur": ["Villa Elvira", "Altos de San Lorenzo", "Sicardi / Villa Garibaldi"]
        };
        const MATCH_LEVELS = ["Tranqui / Joda üçª", "Picado Medio ‚öΩ", "A Morir (Competitivo) üèÜ"];

        // --- COMPONENTES UI REUTILIZABLES (EL SECRETO DE LAS BUENAS PR√ÅCTICAS) ---

        // 1. Bot√≥n del Header M√≥vil
        const MobileHeaderButton = ({ icon: Icon, label, onClick, highlight }) => (
            <button 
                onClick={onClick} 
                className={`flex flex-col items-center justify-center py-2 rounded-lg transition-all active:scale-95 border ${
                    highlight 
                    ? 'bg-[#00ff55] text-black border-[#00cc44] shadow-[0_0_10px_rgba(0,255,85,0.3)]' 
                    : 'bg-[#1a1a1a] text-gray-300 border-gray-800 hover:border-gray-600 hover:text-white'
                }`}
            >
                <Icon size={18} className={highlight ? "mb-1 text-black" : "mb-1 text-[#00ff55]"} />
                <span className="text-[9px] font-black uppercase tracking-wider">{label}</span>
            </button>
        );

        // 2. Tarjeta de Partido (MatchCard)
        const MatchCard = ({ match, user, isAdmin, onDelete, onJoin }) => {
            const isSigned = match.playersSigned?.includes(user?.uid);
            const isCreator = user && match.createdBy === user.uid;
            const canDelete = isAdmin || isCreator;

            return (
                <div className="p-3 border-b border-gray-300 flex justify-between items-center bg-white hover:bg-gray-50 animate-fade-in">
                    <div>
                        <div className="font-bold text-sm flex items-center gap-2">
                            {match.teamName} <span className="bg-black text-[#00ff55] text-[9px] px-1 rounded">{match.format}</span>
                            {match.isChallenge && <span className="text-[9px] bg-yellow-400 text-black px-1 rounded font-black flex gap-1"><Trophy size={8}/> DESAF√çO</span>}
                        </div>
                        <div className="text-xs text-gray-600 flex items-center gap-1 mt-1"><MapPin size={10}/> {match.place} | {match.zone}</div>
                        <div className="flex items-center gap-2 mt-1">
                            <div className="text-xs font-mono font-bold text-green-800">{match.date} - {match.time}</div>
                            <span className="text-[9px] bg-gray-200 px-1 rounded text-gray-600">{match.level}</span>
                        </div>
                        {match.isChallenge && <div className="text-[10px] text-yellow-700 font-bold mt-1">üî• {match.stake}</div>}
                    </div>
                    <div className="flex items-center gap-2">
                        {canDelete && (
                            <button onClick={() => onDelete(match.id)} className="text-red-500 bg-red-100 p-1.5 rounded hover:bg-red-200 transition-colors">
                                <Trash2 size={14}/>
                            </button>
                        )}
                        <button 
                            onClick={() => onJoin(match)} 
                            className={`px-3 py-1.5 rounded text-xs font-bold border-b-2 transition-all active:scale-95 ${
                                isSigned 
                                ? 'bg-red-600 text-white border-red-800 hover:bg-red-700' 
                                : 'bg-[#008f45] text-white border-[#006400] hover:bg-[#007a3b]'
                            }`}
                        >
                            {isSigned ? 'Salir' : 'Anotarme'}
                        </button>
                    </div>
                </div>
            );
        };

        // 3. Tarjeta de Jugador (PlayerCard)
        const PlayerCard = ({ player, user, isAdmin, onDelete, onInvite }) => (
            <div className="bg-white p-2 rounded shadow-sm flex justify-between items-center border border-gray-200">
                <div>
                    <div className="font-bold text-xs uppercase flex items-center gap-1">
                        {player.name} <span className="text-[9px] bg-yellow-100 text-yellow-800 px-1 rounded">‚òÖ {player.rating ? player.rating.toFixed(1) : '-'}</span>
                    </div>
                    <div className="text-[10px] text-gray-500">{player.position} | {player.level}</div>
                </div>
                <div className="flex gap-2">
                    {onInvite && (
                        <button onClick={() => onInvite(player)} className="text-[#00ff55] text-[10px] font-bold border border-[#00ff55] px-2 py-1 rounded hover:bg-[#00ff55] hover:text-black transition-colors">
                            FICHAR
                        </button>
                    )}
                    {(isAdmin || (user && player.uid === user.uid)) && (
                        <button onClick={() => onDelete(player.id)} className="text-red-500 text-[10px] font-bold border border-red-200 px-2 py-1 rounded hover:bg-red-50 transition-colors">
                            BAJARME
                        </button>
                    )}
                </div>
            </div>
        );

        // --- APP PRINCIPAL ---
        const App = () => {
            // ESTADOS
            const [view, setView] = useState('landing');
            const [user, setUser] = useState(null);
            const [userProfile, setUserProfile] = useState(null);
            
            // Firebase Init
            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const [storage, setStorage] = useState(null);

            // Data
            const [matches, setMatches] = useState([]);
            const [players, setPlayers] = useState([]);
            const [invitations, setInvitations] = useState([]);
            const [myTeam, setMyTeam] = useState(null);
            const [loading, setLoading] = useState(true);

            // Modales
            const [activeModal, setActiveModal] = useState(null); // 'login', 'createTeam', 'publish', 'scout', 'invite', 'map'
            const [confirmation, setConfirmation] = useState({ show: false, text: '', action: null });
            
            // Filtros y Formularios
            const [filters, setFilters] = useState({ format: 'Todos', zone: 'Todas' });
            const [forms, setForms] = useState({
                newTeamName: '',
                invitePlace: '', inviteTime: '',
                publish: { type: 'player', format: 'F5', zone: 'La Plata (Casco Urbano)', place: '', time: '', date: '', level: 'Picado Medio ‚öΩ', isChallenge: false, stake: '' },
                neededPositions: ['Cualquiera'],
                playerLevel: 'Picado Medio ‚öΩ'
            });
            const [targetData, setTargetData] = useState(null); // Para guardar a quien invitamos o qu√© editamos

            const isAdmin = user && ADMIN_EMAILS.includes(user.email);
            const pendingInvitations = invitations.filter(inv => inv.status === 'pending');

            // --- FIREBASE SETUP ---
            useEffect(() => {
                const initFirebase = async () => {
                    try {
                        const app = initializeApp({
                            apiKey: "AIzaSyC8att6xIu--GeDn7uY6gHkIrwUU1UhwpM",
                            authDomain: "el-enganche.firebaseapp.com",
                            projectId: "el-enganche",
                            storageBucket: "el-enganche.firebasestorage.app",
                            messagingSenderId: "733812663281",
                            appId: "1:733812663281:web:1e0ba9ca08a331930eda50"
                        });
                        
                        // DESACTIVADO TEMPORALMENTE
                        // initializeAppCheck(app, {
                        //     provider: new ReCaptchaV3Provider('6LdxFE4sAAAAAIcAqm8pq_mfpw1WRzVRJtHiOkP4'),
                        //     isTokenAutoRefreshEnabled: true
                        // });

                        setAuth(getAuth(app));
                        setDb(getFirestore(app));
                        setStorage(getStorage(app));
                    } catch(e) { console.error("Error init firebase:", e); }
                };
                initFirebase();
            }, []);

            // --- AUTH & LISTENERS ---
            useEffect(() => {
                if(!auth || !db) return;
                const unsubAuth = onAuthStateChanged(auth, async (u) => {
                    if (u) {
                        setUser(u.isAnonymous ? null : u);
                        if (!u.isAnonymous) {
                            const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', u.uid);
                            const snap = await getDoc(userRef);
                            if (snap.exists()) setUserProfile(snap.data());
                            else {
                                const newData = { uid: u.uid, name: u.displayName, nickname: u.displayName, email: u.email, position: 'Polifuncional', searchName: u.displayName?.toLowerCase(), createdAt: serverTimestamp() };
                                await setDoc(userRef, newData);
                                setUserProfile(newData);
                            }
                        }
                    } else {
                        signInAnonymously(auth).catch(console.error);
                    }
                });

                // Listeners de Datos
                const todayStr = new Date().toISOString().split('T')[0];
                const qM = query(collection(db, 'artifacts', appId, 'public', 'data', 'matches'), where('date', '>=', new Date(Date.now() - 86400000).toISOString().split('T')[0]));
                const unsubM = onSnapshot(qM, (s) => {
                    setMatches(s.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => new Date(a.date+'T'+a.time) - new Date(b.date+'T'+b.time)));
                    setLoading(false);
                });
                
                const qP = query(collection(db, 'artifacts', appId, 'public', 'data', 'players'), where('createdAt', '>', Timestamp.fromDate(new Date(Date.now() - 86400000 * 7))));
                const unsubP = onSnapshot(qP, (s) => setPlayers(s.docs.map(d => ({id: d.id, ...d.data()}))));

                return () => { unsubAuth(); unsubM(); unsubP(); }
            }, [auth, db]);

            // Listener de Equipo e Invitaciones (Solo si hay usuario)
            useEffect(() => {
                if(!user || !db) return;
                const unsubT = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'teams'), (s) => {
                    const myTeamFound = s.docs.map(d => ({id: d.id, ...d.data()})).find(t => t.captainId === user.uid || t.members?.some(m => m.uid === user.uid));
                    setMyTeam(myTeamFound || null);
                });
                const unsubI = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'invitations'), (s) => {
                    setInvitations(s.docs.map(d => ({id: d.id, ...d.data()})).filter(i => i.toUserId === user.uid));
                });
                return () => { unsubT(); unsubI(); }
            }, [user, db]);

            // --- ACCIONES ---
            const loginGoogle = async () => { try { await signInWithPopup(auth, new GoogleAuthProvider()); setView('app'); setActiveModal(null); } catch(e) { alert(e.message); } };
            const logout = async () => { await signOut(auth); setView('landing'); setUser(null); };

            const askConfirm = (text, action) => setConfirmation({ show: true, text, action });

            // CRUD Partidos
            const handleDeleteMatch = (id) => askConfirm("¬øBorrar partido?", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'matches', id)));
            const handleJoinMatch = async (m) => {
                if(!user) return setActiveModal('login');
                const ref = doc(db, 'artifacts', appId, 'public', 'data', 'matches', m.id);
                try {
                    if(m.playersSigned?.includes(user.uid)) await updateDoc(ref, { missing: increment(1), playersSigned: arrayRemove(user.uid) });
                    else if(m.missing > 0) await updateDoc(ref, { missing: increment(-1), playersSigned: arrayUnion(user.uid) });
                } catch(e) { alert(e.message); }
            };

            const handlePublish = async (e) => {
                e.preventDefault();
                if(!user) return;
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'matches'), {
                        ...forms.publish,
                        missing: forms.publish.type==='rival'?0:forms.neededPositions.length,
                        position: forms.publish.type==='rival'?'Equipo Completo':forms.neededPositions.join(', '),
                        teamName: myTeam ? myTeam.name : (userProfile?.nickname || user.displayName) + " Team",
                        urgent: false, playersSigned: [], createdBy: user.uid, createdAt: serverTimestamp()
                    });
                    setActiveModal(null);
                    alert("¬°Publicado!");
                } catch(e) { alert(e.message); }
            };

            // CRUD Jugadores
            const handlePostulate = async () => {
                if(!user) return setActiveModal('login');
                if(players.some(p => p.uid === user.uid)) return alert("Ya est√°s postulado.");
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'players'), {
                        uid: user.uid, name: userProfile?.nickname || user.displayName, position: userProfile?.position || 'Polifuncional',
                        zone: 'La Plata', level: forms.playerLevel, rating: 0, ratingCount: 0, status: 'Disponible', createdAt: serverTimestamp()
                    });
                } catch(e) { alert(e.message); }
            };
            const handleDeletePlayer = (id) => askConfirm("¬øBajarme?", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'players', id)));

            // CRUD Equipos
            const handleCreateTeam = async (e) => {
                e.preventDefault();
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'teams'), {
                        name: forms.newTeamName, captainId: user.uid, captainName: userProfile?.nickname || user.displayName,
                        members: [{ uid: user.uid, name: userProfile?.nickname || user.displayName, role: 'captain', status: 'active' }],
                        searchName: forms.newTeamName.toLowerCase(), createdAt: serverTimestamp()
                    });
                    setActiveModal(null); setView('team');
                } catch(e) { alert(e.message); }
            };

            // --- VISTAS ---
            if(view === 'landing') {
                return (
                    <div className="flex-1 flex flex-col items-center justify-center p-6 text-center bg-gradient-to-br from-[#003300] to-[#001a00] h-screen text-white">
                        <img src="https://i.imgur.com/F7p7sXT.png" alt="Logo" className="w-64 mb-8 drop-shadow-[0_0_15px_rgba(0,255,85,0.3)] animate-fade-in"/>
                        <div className="w-full max-w-sm space-y-4">
                            {user ? (
                                <button onClick={() => setView('app')} className="w-full bg-[#00ff55] text-black font-black py-4 rounded-xl shadow-lg flex items-center justify-center gap-2">CONTINUAR COMO {userProfile?.nickname?.toUpperCase()}</button>
                            ) : (
                                <button onClick={loginGoogle} className="w-full bg-white text-gray-800 font-bold py-3 px-4 rounded-xl shadow-lg flex items-center justify-center gap-2">
                                    <span className="text-xl">G</span> Ingresar con Google
                                </button>
                            )}
                            <button onClick={() => setView('app')} className="w-full border-2 border-[#00ff55] text-[#00ff55] font-bold py-3 rounded-xl">Solo mirar</button>
                        </div>
                    </div>
                );
            }

            const feedMatches = matches.filter(m => (filters.format === 'Todos' || m.format === filters.format) && (filters.zone === 'Todas' || m.zone === filters.zone));

            return (
                <div className="flex-1 flex flex-col pb-24 bg-gray-50 min-h-screen">
                    {/* HEADER */}
                    <header className="bg-gradient-to-r from-[#003300] to-[#004d26] border-b-4 border-[#00ff55] sticky top-0 z-50 shadow-xl">
                         <div className="flex justify-between items-center px-4 py-3">
                            <img src="https://i.imgur.com/aVwYCPF.png" className="h-8 object-contain" alt="Logo"/>
                            <div className="flex items-center gap-2">
                                {user ? (
                                    <button className="relative text-white" onClick={() => alert("Notificaciones pr√≥ximamente")}>
                                        <Bell size={22} className={pendingInvitations.length > 0 ? "text-[#00ff55] animate-pulse" : ""} />
                                        {pendingInvitations.length > 0 && <span className="absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border border-black"></span>}
                                    </button>
                                ) : (
                                    <button onClick={() => setActiveModal('login')} className="text-[10px] font-bold text-[#00ff55] border border-[#00ff55] px-2 py-1 rounded">INGRESAR</button>
                                )}
                            </div>
                        </div>
                        {/* Botonera M√≥vil */}
                        <div className="sm:hidden grid grid-cols-4 gap-1 p-2 bg-[#002200]">
                            <MobileHeaderButton icon={Share2} label="Invitar" onClick={() => {}} />
                            <MobileHeaderButton icon={PlusCircle} label={!myTeam ? "Crear" : "Publicar"} onClick={() => {
                                if(!user) setActiveModal('login');
                                else if(!myTeam) setActiveModal('createTeam');
                                else if(myTeam.captainId !== user.uid) alert("Solo el capit√°n publica");
                                else setActiveModal('publish');
                            }} highlight={true} />
                            <MobileHeaderButton icon={Download} label="App" onClick={() => alert("Pronto")} />
                            <MobileHeaderButton icon={MapPin} label="Canchas" onClick={() => setActiveModal('map')} />
                        </div>
                    </header>

                    {/* CONTENIDO PRINCIPAL */}
                    <main className="flex-1 max-w-5xl mx-auto w-full p-2 sm:p-4 grid grid-cols-1 lg:grid-cols-12 gap-6">
                        
                        {view === 'app' && (
                            <>
                                {/* Columna Partidos (8/12) */}
                                <div className="lg:col-span-8 space-y-4">
                                    <div className="bg-[#1b4d2e] p-3 rounded-t-lg text-white flex justify-between items-center">
                                        <h2 className="font-bold flex items-center gap-2"><Calendar size={20} className="text-[#00ff55]"/> PARTIDOS</h2>
                                        <div className="flex gap-2">
                                            <select className="bg-black/30 rounded text-xs p-1 border border-white/20" onChange={e => setFilters({...filters, format: e.target.value})}>
                                                <option value="Todos">Fmt: Todos</option><option>F5</option><option>F7</option>
                                            </select>
                                            <select className="bg-black/30 rounded text-xs p-1 border border-white/20" onChange={e => setFilters({...filters, zone: e.target.value})}>
                                                <option value="Todas">Zonas: Todas</option>
                                                {Object.entries(ZONES_BY_AREA).map(([r,zs]) => <optgroup key={r} label={r}>{zs.map(z=><option key={z} value={z}>{z}</option>)}</optgroup>)}
                                            </select>
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-b-lg shadow overflow-hidden min-h-[200px]">
                                        {loading ? <div className="p-10 text-center text-gray-500">Cargando la cancha...</div> : 
                                            feedMatches.length === 0 ? <div className="p-10 text-center text-gray-500">No hay partidos hoy. ¬°Crea uno!</div> :
                                            feedMatches.map(m => (
                                                <MatchCard 
                                                    key={m.id} 
                                                    match={m} 
                                                    user={user} 
                                                    isAdmin={isAdmin} 
                                                    onDelete={handleDeleteMatch}
                                                    onJoin={handleJoinMatch}
                                                />
                                            ))
                                        }
                                    </div>
                                </div>

                                {/* Columna Jugadores (4/12) */}
                                <div className="lg:col-span-4 space-y-4">
                                    <div className="bg-[#212121] text-white p-3 rounded-t-lg border-t-4 border-[#00ff55] font-bold text-sm flex items-center gap-2">
                                        <Users size={16} className="text-[#00ff55]"/> AGENTES LIBRES
                                    </div>
                                    <div className="bg-gray-100 p-2 rounded-b-lg border border-gray-300 space-y-2">
                                        {players.map(p => (
                                            <PlayerCard 
                                                key={p.id} 
                                                player={p} 
                                                user={user} 
                                                isAdmin={isAdmin}
                                                onDelete={handleDeletePlayer}
                                                onInvite={myTeam && myTeam.captainId === user?.uid ? (p) => { setTargetData(p); setActiveModal('invite'); } : null}
                                            />
                                        ))}
                                        <div className="pt-2 border-t border-gray-300 mt-2">
                                            <select className="w-full mb-2 text-xs p-1 rounded border" value={forms.playerLevel} onChange={e=>setForms({...forms, playerLevel: e.target.value})}>
                                                {MATCH_LEVELS.map(l=><option key={l} value={l}>{l}</option>)}
                                            </select>
                                            <button onClick={handlePostulate} className="w-full bg-[#212121] text-[#00ff55] font-bold text-xs py-2 rounded uppercase hover:bg-black transition-colors">
                                                Postularme
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </>
                        )}

                        {view === 'team' && (
                            <div className="lg:col-span-12 bg-[#1a1a1a] p-6 rounded text-center text-white min-h-[50vh] flex flex-col justify-center items-center">
                                {myTeam ? (
                                    <>
                                        <h2 className="text-3xl font-black text-[#00ff55] italic mb-2">{myTeam.name}</h2>
                                        <p className="text-gray-400 mb-6">Capit√°n: {myTeam.captainName}</p>
                                        <div className="bg-gray-800 p-4 rounded w-full max-w-md">
                                            <h3 className="text-left font-bold border-b border-gray-700 pb-2 mb-2">Plantel</h3>
                                            {myTeam.members?.map(m => (
                                                <div key={m.uid} className="flex justify-between items-center py-2 border-b border-gray-700/50">
                                                    <span className="flex items-center gap-2">
                                                        {m.role === 'captain' && <Crown size={14} className="text-yellow-500"/>} {m.name}
                                                    </span>
                                                    <span className={`text-xs px-2 py-0.5 rounded ${m.status==='active'?'bg-green-900 text-green-300':'bg-red-900 text-red-300'}`}>
                                                        {m.status}
                                                    </span>
                                                </div>
                                            ))}
                                        </div>
                                    </>
                                ) : (
                                    <>
                                        <Shield size={64} className="text-gray-700 mb-4"/>
                                        <h3 className="text-xl font-bold">Sin Equipo</h3>
                                        <p className="text-gray-500 mb-4">Crea tu equipo para gestionar tu plantel y desafiar a otros.</p>
                                        <button onClick={() => setActiveModal('createTeam')} className="bg-[#00ff55] text-black font-bold px-6 py-3 rounded-lg hover:scale-105 transition-transform">
                                            CREAR EQUIPO
                                        </button>
                                    </>
                                )}
                            </div>
                        )}

                         {view === 'profile' && (
                             <div className="lg:col-span-12 bg-white p-6 rounded shadow text-center">
                                <div className="w-20 h-20 bg-gray-200 rounded-full mx-auto flex items-center justify-center text-3xl mb-4">üë§</div>
                                <h2 className="text-2xl font-bold text-gray-800">{userProfile?.nickname}</h2>
                                <p className="text-gray-500 mb-6">{user?.email}</p>
                                <button onClick={logout} className="text-red-500 font-bold border border-red-200 px-6 py-2 rounded hover:bg-red-50">Cerrar Sesi√≥n</button>
                             </div>
                         )}

                    </main>

                    {/* NAVBAR INFERIOR */}
                    {view !== 'landing' && (
                        <nav className="fixed bottom-0 w-full bg-black border-t-2 border-[#00ff55] flex justify-around items-center h-16 z-50 shadow-[0_-5px_20px_rgba(0,0,0,0.5)]">
                            <button onClick={() => setView('app')} className={`flex flex-col items-center gap-1 ${view==='app'?'text-[#00ff55]':'text-gray-500'}`}>
                                <Home size={24} className={view==='app'?'fill-current':''}/><span className="text-[10px] font-bold">INICIO</span>
                            </button>
                            <button onClick={() => user ? setView('team') : setActiveModal('login')} className={`flex flex-col items-center gap-1 ${view==='team'?'text-[#00ff55]':'text-gray-500'}`}>
                                <Shield size={24} className={view==='team'?'fill-current':''}/><span className="text-[10px] font-bold">EQUIPO</span>
                            </button>
                            <button onClick={() => user ? setView('profile') : setActiveModal('login')} className={`flex flex-col items-center gap-1 ${view==='profile'?'text-[#00ff55]':'text-gray-500'}`}>
                                <User size={24} className={view==='profile'?'fill-current':''}/><span className="text-[10px] font-bold">PERFIL</span>
                            </button>
                        </nav>
                    )}

                    {/* --- MODALES --- */}
                    {activeModal === 'login' && (
                        <div className="fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4">
                            <div className="bg-[#1a1a1a] p-6 rounded w-full max-w-xs text-center border border-[#00ff55]">
                                <h3 className="text-white font-bold mb-4">ACCESO REQUERIDO</h3>
                                <button onClick={loginGoogle} className="w-full bg-white text-black font-bold py-3 rounded flex items-center justify-center gap-2 mb-2">Ingresar con Google</button>
                                <button onClick={() => setActiveModal(null)} className="text-gray-500 text-xs">Cancelar</button>
                            </div>
                        </div>
                    )}
                    
                    {activeModal === 'createTeam' && (
                        <div className="fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4">
                            <div className="bg-[#1a1a1a] p-6 rounded w-full max-w-sm text-white border border-[#00ff55]">
                                <h3 className="text-[#00ff55] font-black italic text-xl mb-4 text-center">NUEVO EQUIPO</h3>
                                <form onSubmit={handleCreateTeam}>
                                    <input className="w-full bg-black/50 p-2 rounded mb-4 border border-gray-700 text-white" placeholder="Nombre del Equipo" value={forms.newTeamName} onChange={e=>setForms({...forms, newTeamName: e.target.value})} required />
                                    <div className="flex gap-2">
                                        <button type="button" onClick={() => setActiveModal(null)} className="flex-1 py-2 text-gray-500 font-bold text-xs">CANCELAR</button>
                                        <button type="submit" className="flex-1 py-2 bg-[#00ff55] text-black font-black rounded hover:bg-white">CREAR</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {activeModal === 'publish' && (
                        <div className="fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4 animate-fade-in">
                            <div className="bg-[#1a1a1a] p-6 rounded w-full max-w-sm text-white border border-[#00ff55]">
                                <h3 className="text-[#00ff55] font-black italic text-xl mb-4 text-center">PUBLICAR PARTIDO</h3>
                                <form onSubmit={handlePublish} className="space-y-3">
                                    <div className="flex gap-2">
                                        <button type="button" onClick={()=>setForms({...forms, publish: {...forms.publish, type: 'rival'}})} className={`flex-1 py-1 rounded text-xs font-bold ${forms.publish.type==='rival'?'bg-[#00ff55] text-black':'bg-gray-800'}`}>BUSCO RIVAL</button>
                                        <button type="button" onClick={()=>setForms({...forms, publish: {...forms.publish, type: 'player'}})} className={`flex-1 py-1 rounded text-xs font-bold ${forms.publish.type==='player'?'bg-[#00ff55] text-black':'bg-gray-800'}`}>BUSCO JUGADOR</button>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <select className="bg-black/50 p-2 rounded text-sm border border-gray-700" onChange={e=>setForms({...forms, publish: {...forms.publish, format: e.target.value}})}><option>F5</option><option>F7</option><option>F9</option></select>
                                        <select className="bg-black/50 p-2 rounded text-sm border border-gray-700" onChange={e=>setForms({...forms, publish: {...forms.publish, zone: e.target.value}})}><option>La Plata (Casco Urbano)</option><option>City Bell</option><option>Villa Elisa</option><option>Los Hornos</option></select>
                                    </div>
                                    <input type="date" className="w-full bg-black/50 p-2 rounded text-sm border border-gray-700 text-white" min={new Date().toISOString().split('T')[0]} onChange={e=>setForms({...forms, publish: {...forms.publish, date: e.target.value}})} required/>
                                    <div className="flex gap-2">
                                        <input placeholder="Cancha" className="flex-1 bg-black/50 p-2 rounded text-sm border border-gray-700" onChange={e=>setForms({...forms, publish: {...forms.publish, place: e.target.value}})} required/>
                                        <input type="time" className="w-24 bg-black/50 p-2 rounded text-sm border border-gray-700 text-white" onChange={e=>setForms({...forms, publish: {...forms.publish, time: e.target.value}})} required/>
                                    </div>
                                    <button type="submit" className="w-full py-3 bg-[#00ff55] text-black font-black rounded mt-2 hover:bg-white transition-colors">CONFIRMAR</button>
                                    <button type="button" onClick={() => setActiveModal(null)} className="w-full text-gray-500 text-xs mt-2">CANCELAR</button>
                                </form>
                            </div>
                        </div>
                    )}

                    {confirmation.show && (
                        <div className="fixed inset-0 bg-black/90 z-[200] flex items-center justify-center p-4">
                            <div className="bg-[#1a1a1a] p-6 rounded w-full max-w-xs text-center border border-red-500">
                                <h3 className="text-white font-bold mb-4">{confirmation.text}</h3>
                                <div className="flex gap-2">
                                    <button onClick={() => setConfirmation({show:false})} className="flex-1 py-2 text-gray-400">No</button>
                                    <button onClick={() => {confirmation.action(); setConfirmation({show:false})}} className="flex-1 py-2 bg-red-600 text-white rounded font-bold">S√≠</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
